	ALIGN 4,0x90
ADD_MAP_SYMBOLS::
	MOV	ESI,BOOT_ADDRESS-HIGH_ADDRESS+4
@@1:	LODSB
	MOVZX	EBX,AL
	CMP	EBX,eie_lit_export
	JA	@@20
	LODSD
	MOV	EDX,EAX
	CALL	NEW_STRING
	PUSH	ESI
	MOV	EAX,HTE_STRUCT_SIZE
	CALL	MALLOC
	MOV	ECX,ESI
	MOV	DWORD HTE_STRING[ECX],EDI
	MOV	EAX,DWORD [EDI]
	CMP	EAX,0x5F4C4946	//'_LIF'
	JNE	@@2
	MOV	DWORD HTE_TYPE[ECX],HTT_FILE
	JMP	@@10
@@2:	MOV	DWORD HTE_TYPE[ECX],HTT_SYS_SYMBOL
@@10:	MOV	DWORD HTE_USER0[ECX],EDX
	MOV	ESI,EDI
	MOV	EDI,DWORD [SYS_HASH_TABLE]
	CALL	FIND_HASH_BUCKET
	MOV	EAX,DWORD [ESI]
	MOV	DWORD HTE_NEXT[ECX],EAX
	MOV	DWORD [ESI],ECX
	POP	ESI
	CALL	STRLEN
	ADD	ESI,EAX
	INC	ESI
	JMP	@@1

@@20:	CMP	EBX,eie_end
	JE	@@100
	LODSD
	CALL	STRLEN
	ADD	ESI,EAX
	INC	ESI
	JMP	@@1

@@100:	RET
	END
