	ALIGN	4,0x90
NORMAL_KEY_SCAN_DECODE_TABLE:
	DB	0,27,"1234567890-=",8,9;
	DB	"qwertyuiop[]",13,129,"as";
	DB	"dfghjkl;'`",128,"\\zxcv";
	DB	"bnm,./",128,131,130,32,132,133,134,135,136,137;
	DB	0,0,0,0,0,0,0,0,240,0,0,241,0,242,0,0;
	DB	243;
	ALIGN	4,0x90
SHIFT_KEY_SCAN_DECODE_TABLE:
	DB	0,27,"!@#$%^&*()_+",8,9;
	DB	"QWERTYUIOP{}",13,129,"AS";
	DB	"DFGHJKL:\"~",128,"|ZXCV";
	DB	"BNM<>?",128,131,130,32,132,133,134,135,136,137;
	DB	0,0,0,0,0,0,0,0,240,0,0,241,0,242,0,0;
	DB	243;
	ALIGN	4,0x90
CTRL_KEY_SCAN_DECODE_TABLE:
	DB	0,27,"1234567890-=",8,9;
	DB	17,23,5,18,20,25,21,9,15,16,"[]",13,129,1,19;
	DB	4,6,7,8,10,11,12,";'`",128,"\\",26,24,3,22;
	DB	2,14,13,",./",128,131,130,32,132,133,134,135,136,137;
	DB	0,0,0,0,0,0,0,0,240,0,0,241,0,242,0,0;
	DB	243;
	ALIGN	4,0x90
ALT_KEY_SCAN_DECODE_TABLE:
	DB	0,27,"1234567890-=",8,9;
	DB	"qwertyuiop[]",13,129,"as";
	DB	"dfghjkl;'`",128,"\\zxcv";
	DB	"bnm,./",128,131,130,32,132,133,134,135,136,137;
	DB	0,0,0,0,0,0,0,0,240,0,0,241,0,242,0,0;
	DB	243;

////**************************PROCEDURE*************************
	ALIGN	4,0x90
TRANSLATE_SCAN_CODE::
	PUSH	EBX
	BT	DWORD [SYS_CURRENT_SCAN_CODE],SCF_CTRL
	JNC	@@1
	LEA	EBX,DWORD [CTRL_KEY_SCAN_DECODE_TABLE]
	JMP	@@10

@@1:	BT	DWORD [SYS_CURRENT_SCAN_CODE],SCF_ALT
	JNC	@@2
	LEA	EBX,DWORD [ALT_KEY_SCAN_DECODE_TABLE]
	JMP	@@10

@@2:	LEA	EBX,DWORD [NORMAL_KEY_SCAN_DECODE_TABLE]
	BT	DWORD [SYS_CURRENT_SCAN_CODE],SCF_SHIFT
	JNC	@@4
	BT	DWORD [SYS_CURRENT_SCAN_CODE],SCF_CAPS
	JC	@@10
@@3:	LEA	EBX,DWORD [SHIFT_KEY_SCAN_DECODE_TABLE]
	JMP	@@10
@@4:	BT	DWORD [SYS_CURRENT_SCAN_CODE],SCF_CAPS
	JC	@@3

@@10:	MOVZX	EAX,BYTE [SYS_CURRENT_SCAN_CODE]
	AND	AL,0x7F
	MOVZX	EAX,BYTE [EBX+EAX]
	POP	EBX
	RET
////**************************PROCEDURE*************************
	ALIGN	4,0x90
GET_KEY::
	JMP	@@2
@@1:	CALL	SWAP_IN_NEXT
@@2:	BT	WORD FS:[TSS_TASK_FLAGS],TSSF_FOCUS
	JNC	@@1
	BTR	DWORD [SYS_CURRENT_SCAN_CODE],SCF_NEW_KEY
	JNC	@@1
	CALL	TRANSLATE_SCAN_CODE
	RET
	END
