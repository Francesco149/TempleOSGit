#define __BIN_1_TYPE 0x00000002
#define __BIN_1_SIZE 0x000000DC
#define __BIN_1 "\x02\x02\x05\x14\x00\x00\x00\x01\x00\x00\x00\x23\x00\x00\x00\xF4\xFF\xFF\xFF\x05\x23\x00\x00\x00\xF4\xFF\xFF\xFF\x2E\x00\x00\x00\x04\x00\x00\x00\x05\x2E\x00\x00\x00\x04\x00\x00\x00\x20\x00\x00\x00\x12\x00\x00\x00\x05\x20\x00\x00\x00\x12\x00\x00\x00\x13\x00\x00\x00\x02\x00\x00\x00\x02\x05\x06\x05\x00\x00\x00\xEC\xFF\xFF\xFF\x13\x00\x00\x00\x4A\x00\x00\x00\x14\x00\x00\x00\x49\x00\x00\x00\xEF\xFF\xFF\xFF\xE9\xFF\xFF\xFF\xF1\xFF\xFF\xFF\xEA\xFF\xFF\xFF\x14\x00\x00\x00\x02\x04\x18\x0F\x00\x00\x00\x0F\x00\x00\x00\x21\x00\x00\x00\x04\x00\x00\x00\xED\xFD\x25\x39\x52\xC1\xF0\xBF\x18\x0D\x00\x00\x00\x0D\x00\x00\x00\x3D\x00\x00\x00\x01\x00\x00\x00\xC5\xFD\xEF\x37\x52\xC1\xF0\xBF\x18\x12\x00\x00\x00\x12\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x6C\x55\x15\x39\x52\xC1\xF0\xBF\x18\x2F\x00\x00\x00\x11\x00\x00\x00\x18\x00\x00\x00\x01\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x80\x00"





/* <1> <1> (image) */




class MPCtrl {
  BoolI8 core0_done,core1_done;
} mp;


I64 *r1,*r2;

U0 UpdateWin(TaskStruct *task)
{
  GrBitMap *base;
  I64 *old_r;

  if (mp.core0_done) return;

  base=GrAlias(gr_refreshed_base,task);
  old_r=base->r;
  base->color=BLACK;
  GrPutS(base,0,0,"This is not art.");
  GrPutS(base,0,FONT_HEIGHT,"It's just a test pattern.");

  GrSetRotMat(base,r1);
  base->x=200;
  base->y=200;
  base->flags|=BMF_TRANSFORMATION;

  base->pen_width=2;
  base->bkcolor=BLACK;
  GrElemsPlot3(base,0,0,0,__BIN_1);

  base->color=BLUE;
  GrRect3(base,50,75,0,100,50);
  GrRect3(base,75,50,0,50,100);
  base->color=GREEN;
  GrEllipse3(base,100,100,0,50,25);
  GrEllipse3(base,100,100,0,50,25,pi/2);
  base->color=LTGREEN;
  GrEllipse3(base,100,100,0,50,25,pi/6);
  GrEllipse3(base,100,100,0,50,25,pi/3);

  GrSetRotMat(base,old_r);
  GrDel(base);
  mp.core0_done=TRUE;
}


U0 MPDrawIt(TaskStruct *main_task)
{
  GrBitMap *base;
  I64 *old_r;

  if (mp.core1_done) return;

  base=GrAlias(gr_persistent_base,Fs);
  old_r=base->r;
  base->win_task=main_task;
  GrSetRotMat(base,r2);
  base->x=200;
  base->y=200;
  base->flags|=BMF_TRANSFORMATION;

  GrClear(base);

  base->pen_width=2;
  base->bkcolor=BLACK;
  GrElemsPlot3(base,0,0,0,__BIN_1);

  base->color=BLUE;
  GrRect3(base,50,75,0,100,50);
  GrRect3(base,75,50,0,50,100);

  base->color=GREEN;
  GrEllipse3(base,100,100,0,50,25);
  GrEllipse3(base,100,100,0,50,25,pi/2);

  base->color=LTGREEN;
  GrEllipse3(base,100,100,0,50,25,pi/6);
  GrEllipse3(base,100,100,0,50,25,pi/3);

  GrSetRotMat(base,old_r);
  GrDel(base);
  mp.core1_done=TRUE;
}

U0 DoIt()
{
  F64 theta2=0,phi2=0,theta3=0,phi3=0;
  mp.core0_done=TRUE;
  mp.core1_done=TRUE;
  r1=GrIdent;
  r2=GrIdent;

  SettingsPush; //See [C:/LT/Adam/TaskSettings.APZ,3] SettingsPush
  Fs->update_win=&UpdateWin;
  Preempt(OFF); //Don't access r1,r2 while being changed

  while (!ScanChar) {
    GrIdentEqu(r1);
    GrRotXEqu(r1,phi2);
    GrRotZEqu(r1,theta2);

    GrIdentEqu(r2);
    GrRotXEqu(r2,phi3);
    GrRotZEqu(r2,theta3);

    mp.core0_done=FALSE;
    mp.core1_done=FALSE;

    //Pass the task of the window as data item to job.
    MPJob(&MPDrawIt,Fs,1<<MPCf_FREE_ON_COMPLETE,1<<1);

    WinSync;
    while (!mp.core0_done || !mp.core1_done)
      Yield;

    theta2+=2*pi/100;
    phi2	+=2*pi/130;
    theta3-=2*pi/100;
    phi3	-=2*pi/130;
  }
  GrClear;

  SettingsPop;
  Free(r1);
  Free(r2);
}

DoIt;
